var svg = d3.select("#coolsvg");
var textwidth = 800;
var dat = ["ivamus egestas metus sit amet justo posuere tincidunt. Pellentesque consectetur, leo quis dapibus aliquet, nunc metus laoreet erat, quis scelerisque nunc nisl ut risus. Integer semper est nec odio hendrerit, vulputate lacinia ex tincidunt. Fusce at orci quis ligula laoreet laoreet a quis est. Donec eros lectus, rutrum vitae egestas sed, commodo at elit. Donec tempus lectus eget vestibulum faucibus. Donec euismod dapibus elit, vel volutpat nulla luctus non. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Suspendisse pellentesque suscipit velit, vel scelerisque ante volutpat quis. Integer mollis, lacus id faucibus molestie, urna lacus tempus eros, a fermentum felis lacus nec enim. Etiam id pharetra ligula. Quisque non tortor ornare justo lacinia rhoncus. Vivamus egestas metus sit amet justo posuere tincidunt. Pellentesque consectetur, leo quis dapibus aliquet, nunc metus laoreet erat, quis scelerisque nunc nisl ut risus. Integer semper est nec odio hendrerit, vulputate lacinia ex tincidunt. Fusce at orci quis ligula laoreet laoreet a quis est. Donec eros lectus, rutrum vitae egestas sed, commodo at elit. Donec tempus lectus eget vestibulum faucibus. Donec euismod dapibus elit, vel volutpat nulla luctus non. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Suspendisse pellentesque suscipit velit, vel scelerisque ante volutpat quis. Integer mollis, lacus id faucibus molestie, urna lacus tempus eros, a fermentum felis lacus nec enim. Etiam id pharetra ligula. Quisque non tortor ornare justo lacinia rhoncus. Vivamus egestas metus sit amet justo posuere tincidunt. Pellentesque consectetur, leo quis dapibus aliquet, nunc metus laoreet erat, quis scelerisque nunc nisl ut risus. Integer semper est nec odio hendrerit, vulputate lacinia ex tincidunt. Fusce at orci quis ligula laoreet laoreet a quis est. Donec eros lectus, rutrum vitae egestas sed, commodo at elit. Donec tempus lectus eget vestibulum faucibus. Donec euismod dapibus elit, vel volutpat nulla luctus non. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Suspendisse pellentesque suscipit velit, vel scelerisque ante volutpat quis. Integer mollis, lacus id faucibus molestie, urna lacus tempus eros, a fermentum felis lacus nec enim. Etiam id pharetra ligula. Quisque non tortor ornare justo lacinia rhoncus. Vivamus egestas metus sit amet justo posuere tincidunt. Pellentesque consectetur, leo quis dapibus aliquet, nunc metus laoreet erat, quis scelerisque nunc nisl ut risus. Integer semper est nec odio hendrerit, vulputate lacinia ex tincidunt. Fusce at orci quis ligula laoreet laoreet a quis est. Donec eros lectus, rutrum vitae egestas sed, commodo at elit. Donec tempus lectus eget vestibulum faucibus. Donec euismod dapibus elit, vel volutpat nulla luctus non. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Suspendisse pellentesque suscipit velit, vel scelerisque ante volutpat quis. Integer mollis, lacus id faucibus molestie, urna lacus tempus eros, a fermentum felis lacus nec enim. Etiam id pharetra ligula. Quisque non tortor ornare justo lacinia rhoncus. Vivamus egestas metus sit amet justo posuere tincidunt. Pellentesque consectetur, leo quis dapibus aliquet, nunc metus laoreet erat, quis scelerisque nunc nisl ut risus. Integer semper est nec odio hendrerit, vulputate lacinia ex tincidunt. Fusce at orci quis ligula laoreet laoreet a quis est. Donec eros lectus, rutrum vitae egestas sed, commodo at elit. Donec tempus lectus eget vestibulum faucibus. Donec euismod dapibus elit, vel volutpat nulla luctus non. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Suspendisse pellentesque suscipit velit, vel scelerisque ante volutpat quis. Integer mollis, lacus id faucibus molestie, urna lacus tempus eros, a fermentum felis lacus nec enim. Etiam id pharetra ligula. Quisque non tortor ornare justo lacinia rhoncus. Vivamus egestas metus sit amet justo posuere tincidunt. Pellentesque consectetur, leo quis dapibus aliquet, nunc metus laoreet erat, quis scelerisque nunc nisl ut risus. Integer semper est nec odio hendrerit, vulputate lacinia ex tincidunt. Fusce at orci quis ligula laoreet laoreet a quis est. Donec eros lectus, rutrum vitae egestas sed, commodo at elit. Donec tempus lectus eget vestibulum faucibus. Donec euismod dapibus elit, vel volutpat nulla luctus non. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Suspendisse pellentesque suscipit velit, vel scelerisque ante volutpat quis. Integer mollis, lacus id faucibus molestie, urna lacus tempus eros, a fermentum felis lacus nec enim. Etiam id pharetra ligula. Quisque non tortor ornare justo lacinia rhoncus. ivamus egestas metus sit amet justo posuere tincidunt. Pellentesque consectetur, leo quis dapibus aliquet, nunc metus laoreet erat, quis scelerisque nunc nisl ut risus. Integer semper est nec odio hendrerit, vulputate lacinia ex tincidunt. Fusce at orci quis ligula laoreet laoreet a quis est. Donec eros lectus, rutrum vitae egestas sed, commodo at elit. Donec tempus lectus eget vestibulum faucibus. Donec euismod dapibus elit, vel volutpat nulla luctus non. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Suspendisse pellentesque suscipit velit, vel scelerisque ante volutpat quis. Integer mollis, lacus id faucibus molestie, urna lacus tempus eros, a fermentum felis lacus nec enim. Etiam id pharetra ligula. Quisque non tortor ornare justo lacinia rhoncus. Vivamus egestas metus sit amet justo posuere tincidunt. Pellentesque consectetur, leo quis dapibus aliquet, nunc metus laoreet erat, quis scelerisque nunc nisl ut risus. Integer semper est nec odio hendrerit, vulputate lacinia ex tincidunt. Fusce at orci quis ligula laoreet laoreet a quis est. Donec eros lectus, rutrum vitae egestas sed, commodo at elit. Donec tempus lectus eget vestibulum faucibus. Donec euismod dapibus elit, vel volutpat nulla luctus non. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Suspendisse pellentesque suscipit velit, vel scelerisque ante volutpat quis. Integer mollis, lacus id faucibus molestie, urna lacus tempus eros, a fermentum felis lacus nec enim. Etiam id pharetra ligula. Quisque non tortor ornare justo lacinia rhoncus. Vivamus egestas metus sit amet justo posuere tincidunt. Pellentesque consectetur, leo quis dapibus aliquet, nunc metus laoreet erat, quis scelerisque nunc nisl ut risus. Integer semper est nec odio hendrerit, vulputate lacinia ex tincidunt. Fusce at orci quis ligula laoreet laoreet a quis est. Donec eros lectus, rutrum vitae egestas sed, commodo at elit. Donec tempus lectus eget vestibulum faucibus. Donec euismod dapibus elit, vel volutpat nulla luctus non. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Suspendisse pellentesque suscipit velit, vel scelerisque ante volutpat quis. Integer mollis, lacus id faucibus molestie, urna lacus tempus eros, a fermentum felis lacus nec enim. Etiam id pharetra ligula. Quisque non tortor ornare justo lacinia rhoncus. Vivamus egestas metus sit amet justo posuere tincidunt. Pellentesque consectetur, leo quis dapibus aliquet, nunc metus laoreet erat, quis scelerisque nunc nisl ut risus. Integer semper est nec odio hendrerit, vulputate lacinia ex tincidunt. Fusce at orci quis ligula laoreet laoreet a quis est. Donec eros lectus, rutrum vitae egestas sed, commodo at elit. Donec tempus lectus eget vestibulum faucibus. Donec euismod dapibus elit, vel volutpat nulla luctus non. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Suspendisse pellentesque suscipit velit, vel scelerisque ante volutpat quis. Integer mollis, lacus id faucibus molestie, urna lacus tempus eros, a fermentum felis lacus nec enim. Etiam id pharetra ligula. Quisque non tortor ornare justo lacinia rhoncus. Vivamus egestas metus sit amet justo posuere tincidunt. Pellentesque consectetur, leo quis dapibus aliquet, nunc metus laoreet erat, quis scelerisque nunc nisl ut risus. Integer semper est nec odio hendrerit, vulputate lacinia ex tincidunt. Fusce at orci quis ligula laoreet laoreet a quis est. Donec eros lectus, rutrum vitae egestas sed, commodo at elit. Donec tempus lectus eget vestibulum faucibus. Donec euismod dapibus elit, vel volutpat nulla luctus non. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Suspendisse pellentesque suscipit velit, vel scelerisque ante volutpat quis. Integer mollis, lacus id faucibus molestie, urna lacus tempus eros, a fermentum felis lacus nec enim. Etiam id pharetra ligula. Quisque non tortor ornare justo lacinia rhoncus. Vivamus egestas metus sit amet justo posuere tincidunt. Pellentesque consectetur, leo quis dapibus aliquet, nunc metus laoreet erat, quis scelerisque nunc nisl ut risus. Integer semper est nec odio hendrerit, vulputate lacinia ex tincidunt. Fusce at orci quis ligula laoreet laoreet a quis est. Donec eros lectus, rutrum vitae egestas sed, commodo at elit. Donec tempus lectus eget vestibulum faucibus. Donec euismod dapibus elit, vel volutpat nulla luctus non. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Suspendisse pellentesque suscipit velit, vel scelerisque ante volutpat quis. Integer mollis, lacus id faucibus molestie, urna lacus tempus eros, a fermentum felis lacus nec enim. Etiam id pharetra ligula. Quisque non tortor ornare justo lacinia rhoncus. "];

// alert("I actually do something");
svg.select("#appearing_text")
    .data(dat)
    .text(d => d)
    .call(wrap, textwidth);
dlines()

function dlines() {
    svg.selectAll("tspan")
        .each(function (elem, i) {
            // console.log(this)
            // console.log(d3.select(this).attr("dy").replace("em","")*Math.random())
            var fontSize = d3.select(this).attr("font-size")
            // dy = d3.select(this).attr("dy").replace("px","")
            var dy = 25

            if (dy > 300) {
                var dyNew = dy*(Math.random())
                // var dyNew = 0
                // console.log(dy)
            // } if (dy < 5) {
            //     var dyNew = dy*(Math.random()+1)
            } else {
                var dyNew = dy*(Math.random()+0.5)
            }

            if (fontSize > 25) {
                var fontSizeNew = fontSize*(Math.random())
            } if (fontSize < 3) {
                var fontSizeNew = fontSize*(Math.random()+1)
            } else {
                var fontSizeNew = fontSize*(Math.random()+0.5)
            }

            if (Math.random() >0.8) {
                var newColor = "black"
            } else {
                var newColor = "white"
            }

            d3.select(this).transition()
                .ease(d3.easeLinear)
                .duration(1500)
                .attr("dy", dyNew + "px")
                .attr("dx", Math.random()*100 +"px")
                .attr("font-size", fontSizeNew)
                .attr("fill", newColor)
                .on('end', dlines)
        })
}



function wrap(text, width) {
    text.each(function () {
        var text = d3.select(this),
            words = text.text().split(/\s+/).reverse(),
            word,
            line = [],
            lineNumber = 0,
            lineHeight = 0.7, // ems
            x = text.attr("x"),
            y = text.attr("y"),
            dy = 0, //parseFloat(text.attr("dy")),
            dx = 0,
            tspan = text.text(null)
                        .append("tspan")
                        .attr("x", x)
                        .attr("y", y)
                        .attr("dy", dy + "px")
                        .attr("dx", dx + "px");
        while (word = words.pop()) {
            line.push(word);
            tspan.text(line.join(" "));
            if (tspan.node().getComputedTextLength() > width) {
                line.pop();
                tspan.text(line.join(" "));
                line = [word];
                tspan = text.append("tspan")
                            .attr("x", 0)
                            .attr("y", y)
                            // .attr("dy", ++lineNumber * lineHeight*(0.4+Math.random()) + dy + "em")
                            .attr("dy", dy + "px")
                            .attr("dx", dx + "px")
                            .attr("font-size", 5*(0.5+Math.random()))
                            .attr("text-align", "center")
                            .text(word);
            }
        }
    });
}